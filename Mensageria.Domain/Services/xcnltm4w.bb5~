using Mensageria.Domain.Dtos;
using Mensageria.Domain.Entities;
using Mensageria.Domain.Events;
using Mensageria.Domain.Interfaces.Messages;
using Mensageria.Domain.Interfaces.Repositories;
using Mensageria.Domain.Interfaces.Services;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace Mensageria.Domain.Services
{
    public class ArchiveServices : IArchiveServices
    {
        private readonly IArchiveRepositories _archiveRepositories;
        private readonly ISendArchiveMessage _sendArchiveMessage;

        public ArchiveServices(IArchiveRepositories archiveRepositories, ISendArchiveMessage sendArchiveMessage)
        {
            _archiveRepositories = archiveRepositories;
            _sendArchiveMessage = sendArchiveMessage;
        }

        public ArchiveResponseDto CreateArchive(ArchiveRequestDto archiveDto)
        {
            var archive = new Archive
            {
                Name = archiveDto.Name,
                Type = archiveDto.Type,
                Content = archiveDto.Content
            };

            var archiveCreated = _archiveRepositories.Create(archive);

            return new ArchiveResponseDto
            {
                Id = archiveCreated.Id,
                Name = archiveCreated.Name,
                Type = archiveCreated.Type,
                Content = archiveCreated.Content
            };

        }

        public ArchiveResponseDto GetArchiveBydId(Guid Id, string Email)
        {
            var archive = _archiveRepositories.GetById(Id);

            var archiveSend = new SendArchiveEvents
            {
                Id = archive.Id,
                ArchiveName = archive.Name,
                ArchiveType = archive.Type,
                Email = Email,
                ArchiveContent = archive.Content
            };

            _sendArchiveMessage.Publisher(archiveSend); //envio para fila

            return new ArchiveResponseDto
            {
                Id = archive.Id,
                Name = archive.Name,
                Type = archive.Type,
                Content = archive.Content
            };
        }
    }
}
